name: Build (Debian)

on:
  - push
  - pull_request

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        arch: [x86]
        python-version: [3.9]

    steps:
    - uses: actions/checkout@v3
    - name: Python ${{ matrix.python-version }} wird eingerichtet
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    - name: Dependencies werden installiert
      run: |
        python -m pip install --upgrade pip
        pip install stdeb
        pip install poetry
        sudo apt install fakeroot debhelper python3-all dh-python
    - name: Python-Projekt wird installiert
      run: |
        echo "0"
        poetry build
        echo "1"
        cd dist/
        echo "2"
        py2dsc *tar.gz
        echo "3"
        cd deb_dist/smartfme-reciever-0.1.0/
        echo "4"
        dpkg-buildpackage -rfakeroot -uc -us
        echo "5"
        cd ..
        echo "6"
        sudo apt install ./*_all.deb

    - name: Scripts werden getestet
      run: |
        echo ":)"
